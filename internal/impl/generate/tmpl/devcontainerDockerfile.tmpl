{{- if .RootUser }}FROM jetpackio/devbox-root-user:latest
{{- else }}FROM jetpackio/devbox:latest
{{- end}}

# Installing your devbox project
USER ${DEVBOX_USER}:${DEVBOX_USER}
WORKDIR /code
COPY --chown=${DEVBOX_USER}:${DEVBOX_USER} devbox.json devbox.json
COPY --chown=${DEVBOX_USER}:${DEVBOX_USER} devbox.lock devbox.lock
{{if len .LocalFlakeDirs}}
# Step 6: Copying local flakes directories
{{- end}}
{{range $i, $element := .LocalFlakeDirs -}}
COPY {{$element}} {{$element}}
{{end}}
RUN devbox run -- echo "Installed Packages."
{{if .IsDevcontainer}}
RUN devbox shellenv --init-hook >> ~/.profile
{{- else}}
CMD ["devbox", "shell"]
{{- end}}
